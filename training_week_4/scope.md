# Области видимости (Scope)

Области видимости (Scope) в Python определяют, в какой части программы переменная или функция доступна для использования. Понимание этой концепции критически важно для написания качественного кода и избежания трудноуловимых ошибок[^1].

## Правило LEGB

Python использует правило **LEGB** для определения последовательности поиска переменных. Это акроним, обозначающий четыре области видимости в порядке приоритета[^1][^5]:

- **L (Local)** — локальная область внутри функции
- **E (Enclosing)** — вложенная область внешних функций
- **G (Global)** — глобальная область на уровне модуля
- **B (Built-in)** — встроенная область с предопределенными функциями


## Встроенная область видимости (Built-in)

Встроенная область содержит предопределенные функции и типы, доступные в любой части программы. Она загружается автоматически при запуске интерпретатора Python[^1]:

```python
# Примеры встроенных функций
print()    # вывод данных
len()      # длина объекта
type()     # тип объекта
range()    # генерация последовательности чисел
sum()      # сумма элементов
```


## Глобальная область видимости

Глобальные переменные объявляются вне функций на уровне модуля и доступны из любой части программы[^4][^11]:

```python
password = "Python"  # глобальная переменная

def check_password(pwd):
    return pwd == password  # доступ к глобальной переменной

print(check_password("123"))  # False
```

Глобальные переменные можно читать из функций, но для их изменения требуется специальное ключевое слово `global`[^7].

## Локальная область видимости

Локальные переменные существуют только внутри функции, где они объявлены, и уничтожаются после завершения выполнения функции[^1][^11]:

```python
def greet():
    message = "Hello, World!"  # локальная переменная
    print(message)

greet()  # выведет: Hello, World!
# print(message)  # ошибка: NameError
```

При каждом вызове функции создаются новые экземпляры локальных переменных, независимо от предыдущих вызовов[^1].

## Вложенная область видимости (Enclosing)

Вложенная область возникает, когда одна функция определена внутри другой. Внутренняя функция имеет доступ к переменным внешней функции[^5]:

```python
def outer():
    x = 10  # переменная внешней функции
    
    def inner():
        print(x)  # доступ к переменной внешней функции
    
    inner()

outer()  # выведет: 10
```


## Нелокальные переменные

Для изменения переменных внешней функции из вложенной функции используется ключевое слово `nonlocal`[^11]:

```python
def outer():
    message = 'local'
    
    def inner():
        nonlocal message  # объявляем нелокальную переменную
        message = 'nonlocal'
        print("inner:", message)
    
    inner()
    print("outer:", message)

outer()
# inner: nonlocal
# outer: nonlocal
```


## Правила определения области видимости

Область видимости переменной определяется **местом, где ей присваивается значение**, а не местом использования[^8]. По умолчанию все переменные, которым присваиваются значения внутри функции, становятся локальными для этой функции[^8].

## Затенение переменных

Если локальная переменная имеет то же имя, что и глобальная, она **затеняет** глобальную переменную[^7]:

```python
x = 10  # глобальная переменная

def shadow():
    x = 5  # локальная переменная затеняет глобальную
    print(f'x={x}')

shadow()  # x=5
print(f'x={x}')  # x=10 (глобальная не изменилась)
```


## Свободные переменные

Переменная называется **свободной**, если она используется в блоке кода, но не определена в нем. Свободные переменные разрешаются в глобальном пространстве имен[^7].

Понимание областей видимости помогает избежать серьезных проблем, таких как случайное переопределение глобальных переменных или использование переменных до их объявления[^1].

<div style="text-align: center">⁂</div>

[^1]: https://habr.com/ru/companies/otus/articles/824554/

[^2]: https://metanit.com/python/tutorial/2.9.php

[^3]: https://tproger.ru/articles/oblasti-vidimosti-v-python-o-kotoryh-vy-ne-znali

[^4]: https://education.yandex.ru/handbook/python/article/funkcii-oblasti-vidimosti-peredacha-parametrov-v-funkcii

[^5]: https://sky.pro/media/pravila-oblasti-vidimosti-v-python/

[^6]: https://codebra.ru/ru/lessons-python/hellopython/13/3

[^7]: https://docs-python.ru/tutorial/opredelenie-funktsij-python/oblast-vidimosti-peremennyh/

[^8]: https://foxford.ru/wiki/informatika/oblasti-vidimosti-peremennyh-v-python

[^9]: https://habr.com/ru/companies/otus/articles/487952/

[^10]: https://senjun.ru/courses/python/chapters/python_chapter_0220/

[^11]: https://ravesli.com/python-variable-scope/

[^12]: https://pmc.ncbi.nlm.nih.gov/articles/PMC9910386/

[^13]: https://arxiv.org/html/2312.02827v1

[^14]: http://arxiv.org/pdf/2402.03135.pdf

[^15]: https://s.top-technologies.ru/pdf/2021/5/38664.pdf

[^16]: https://computeroptics.ru/KO/PDF/KO47-5/470502.pdf

[^17]: http://computeroptics.ru/KO/PDF/KO45-4/450414.pdf

